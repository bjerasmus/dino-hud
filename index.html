<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DinoDawgs Battle HUD</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700;900&display=swap" rel="stylesheet">
    <script src="https://portals-labs.github.io/portals-sdk/portals-sdk.js?v=10005456"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        html, body {
            width: 100%; height: 100%;
            overflow: hidden;
            background: transparent !important;
            background-color: transparent !important;
            font-family: 'Orbitron', sans-serif;
            color: #3efcff;
            user-select: none;
            -webkit-user-select: none;
        }

        body { pointer-events: none; }

        .hud-container {
            position: fixed;
            top: 0; left: 0;
            width: 100%; height: 100%;
            pointer-events: none;
        }

        /* ═══ Ancient Tech Panel ═══ */
        .panel {
            background: rgba(20, 25, 30, 0.55);
            border: 2px solid #3efcff;
            border-radius: 12px;
            padding: 12px 16px;
            box-shadow: 0 0 12px #3efcff, inset 0 0 18px rgba(0,255,255,0.15);
            backdrop-filter: blur(6px);
            -webkit-backdrop-filter: blur(6px);
        }

        /* ═══ Bottom-Left: VITALS ═══ */
        .vitals {
            position: absolute;
            bottom: 30px; left: 30px;
            width: 280px;
        }

        .vitals .label {
            font-size: 11px; font-weight: 700;
            text-transform: uppercase;
            margin-bottom: 4px;
            letter-spacing: 3px;
            text-shadow: 0 0 8px #3efcff;
        }

        .health-container { margin-bottom: 14px; }
        .armor-container { margin-bottom: 0; }

        .bar-wrapper {
            position: relative;
            width: 100%; height: 30px;
            background: rgba(0,0,0,0.6);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid rgba(62,252,255,0.3);
        }

        .bar {
            position: absolute;
            top: 0; left: 0;
            height: 100%;
            transition: width 0.3s ease;
            border-radius: 6px;
        }

        .health-bar {
            background: linear-gradient(90deg, #00ff88, #00ffaa);
            box-shadow: 0 0 10px #00ff88;
        }

        .armor-bar {
            background: linear-gradient(90deg, #4aa3ff, #7efcff);
            box-shadow: 0 0 10px #4aa3ff;
        }

        .bar-text {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px; font-weight: 900;
            color: white;
            text-shadow: 0 0 6px rgba(0,0,0,0.8), 0 2px 4px rgba(0,0,0,0.6);
            z-index: 2;
        }

        .pulse-red { animation: pulseRed 0.8s ease-in-out infinite; }
        .pulse-blue { animation: pulseBlue 0.8s ease-in-out infinite; }

        @keyframes pulseRed {
            0%,100% { box-shadow: 0 0 10px #ff0000; }
            50% { box-shadow: 0 0 25px #ff0000; filter: brightness(1.4); }
        }
        @keyframes pulseBlue {
            0%,100% { box-shadow: 0 0 10px #4aa3ff; }
            50% { box-shadow: 0 0 25px #4aa3ff; filter: brightness(1.4); }
        }

        /* ═══ Boost Indicator ═══ */
        .boost-indicator {
            position: absolute;
            bottom: 170px; left: 30px;
            padding: 6px 14px;
            background: rgba(255,215,0,0.15);
            border: 2px solid #ffd700;
            border-radius: 8px;
            box-shadow: 0 0 12px #ffd700;
            font-size: 12px; font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #ffd700;
            text-shadow: 0 0 8px #ffd700;
            display: none;
        }
        .boost-indicator.active {
            display: block;
            animation: boostPulse 1s ease-in-out infinite;
        }
        @keyframes boostPulse {
            0%,100% { box-shadow: 0 0 12px #ffd700; }
            50% { box-shadow: 0 0 24px #ffd700; }
        }

        /* ═══ Bottom-Right: WEAPON ═══ */
        .weapon-panel {
            position: absolute;
            bottom: 30px; right: 30px;
            width: 240px;
            text-align: center;
        }

        .weapon-icon {
            width: 120px; height: 50px;
            margin: 0 auto 8px;
        }

        .weapon-svg {
            fill: #3efcff;
            filter: drop-shadow(0 0 8px #3efcff);
        }

        .weapon-name {
            font-size: 14px; font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            margin-bottom: 6px;
            text-shadow: 0 0 8px #3efcff;
        }

        .ammo-display {
            font-size: 30px; font-weight: 900;
            color: white;
            text-shadow: 0 0 10px #3efcff;
            letter-spacing: 2px;
        }
        .ammo-low { color: #ffaa00; text-shadow: 0 0 10px #ffaa00; }
        .ammo-empty { color: #ff3333; text-shadow: 0 0 10px #ff3333; animation: pulseRed 0.8s ease-in-out infinite; }

        /* ═══ Top-Left: SCORE ═══ */
        .score-panel {
            position: absolute;
            top: 30px; left: 30px;
            width: 220px;
        }

        .score-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
        }

        .score-item { text-align: center; flex: 1; }

        .score-label {
            font-size: 10px; font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-bottom: 2px;
            text-shadow: 0 0 6px #3efcff;
        }

        .score-value {
            font-size: 32px; font-weight: 900;
            color: white;
            text-shadow: 0 0 10px #3efcff;
        }

        .kd-ratio {
            text-align: center;
            font-size: 14px; font-weight: 700;
            padding-top: 8px;
            border-top: 1px solid rgba(62,252,255,0.3);
        }

        .streak-badge {
            text-align: center;
            font-size: 12px; font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            margin-top: 10px;
            padding: 6px 8px;
            background: rgba(255,215,0,0.15);
            border: 1px solid #ffd700;
            border-radius: 6px;
            color: #ffd700;
            text-shadow: 0 0 8px #ffd700;
            box-shadow: 0 0 10px rgba(255,215,0,0.4);
            display: none;
        }
        .streak-badge.active { display: block; }

        /* ═══ Top-Center: TIMER (hidden default) ═══ */
        .timer-panel {
            position: absolute;
            top: 30px; left: 50%;
            transform: translateX(-50%);
            min-width: 160px;
            text-align: center;
            display: none;
        }
        .timer-panel.active { display: block; }

        .timer-display {
            font-size: 38px; font-weight: 900;
            color: white;
            text-shadow: 0 0 12px #3efcff;
            letter-spacing: 4px;
        }
        .timer-warning {
            color: #ff3333;
            text-shadow: 0 0 12px #ff3333;
            animation: pulseRed 0.8s ease-in-out infinite;
        }

        /* ═══ Top-Right: HUD TOGGLE ═══ */
        .hud-toggle {
            position: absolute;
            top: 20px; right: 20px;
            width: 44px; height: 44px;
            border-radius: 10px;
            background: rgba(20, 25, 30, 0.65);
            border: 2px solid #3efcff;
            box-shadow: 0 0 10px rgba(62,252,255,0.4);
            backdrop-filter: blur(6px);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            pointer-events: auto;
            z-index: 1000;
            transition: all 0.2s ease;
        }
        .hud-toggle:hover {
            box-shadow: 0 0 18px rgba(62,252,255,0.7);
            background: rgba(20, 25, 30, 0.85);
        }
        .hud-toggle:active { transform: scale(0.92); }
        .hud-toggle svg {
            width: 22px; height: 22px;
            fill: #3efcff;
            filter: drop-shadow(0 0 4px #3efcff);
            transition: opacity 0.2s;
        }
        .hud-toggle.hidden svg.eye-open { display: none; }
        .hud-toggle:not(.hidden) svg.eye-closed { display: none; }

        .hud-elements.hud-hidden { opacity: 0; pointer-events: none; transition: opacity 0.25s ease; }
        .hud-elements { transition: opacity 0.25s ease; }

        /* ═══ Center: CROSSHAIR ═══ */
        .crosshair {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 40px; height: 40px;
        }

        .xh-line {
            position: absolute;
            background: rgba(255,255,255,0.75);
            transition: background 0.1s ease;
        }
        .xh-top { top: 0; left: 50%; transform: translateX(-50%); width: 2px; height: 12px; }
        .xh-bot { bottom: 0; left: 50%; transform: translateX(-50%); width: 2px; height: 12px; }
        .xh-lft { left: 0; top: 50%; transform: translateY(-50%); width: 12px; height: 2px; }
        .xh-rgt { right: 0; top: 50%; transform: translateY(-50%); width: 12px; height: 2px; }

        .xh-dot {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            width: 3px; height: 3px;
            background: rgba(255,255,255,0.85);
            border-radius: 50%;
        }

        .crosshair.hit .xh-line, .crosshair.hit .xh-dot {
            background: #ff3333;
            box-shadow: 0 0 6px #ff3333;
        }

        /* ═══ Kill Feed ═══ */
        .kill-feed {
            position: absolute;
            top: calc(50% + 50px);
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            gap: 4px;
            align-items: center;
            z-index: 200;
        }

        .kf-msg {
            font-size: 16px; font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #ff3333;
            text-shadow: 0 0 10px #ff3333, 0 0 20px rgba(255,51,51,0.4);
            padding: 4px 16px;
            background: rgba(255,0,0,0.1);
            border-left: 3px solid #ff3333;
            border-radius: 0 4px 4px 0;
            animation: kfSlide 2.5s ease-out forwards;
        }

        @keyframes kfSlide {
            0% { opacity: 0; transform: translateY(-10px) scale(0.95); }
            8% { opacity: 1; transform: translateY(0) scale(1); }
            75% { opacity: 1; }
            100% { opacity: 0; transform: translateY(6px); }
        }

        /* ═══ Pickup Flash ═══ */
        .pickup-flash {
            position: absolute;
            top: 38%; left: 50%;
            transform: translateX(-50%);
            z-index: 300;
            font-size: 16px; font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 3px;
            opacity: 0;
            text-align: center;
        }
        .pickup-flash.active {
            animation: pickupAnim 2s ease-out forwards;
        }
        @keyframes pickupAnim {
            0% { opacity: 0; transform: translateX(-50%) translateY(8px) scale(0.9); }
            10% { opacity: 1; transform: translateX(-50%) translateY(0) scale(1.05); }
            20% { transform: translateX(-50%) translateY(0) scale(1); }
            70% { opacity: 1; }
            100% { opacity: 0; transform: translateX(-50%) translateY(-10px); }
        }

        /* ═══ Streak Announce ═══ */
        .streak-announce {
            position: absolute;
            top: 25%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 400;
            opacity: 0;
            text-align: center;
        }
        .streak-announce.active {
            animation: streakAnim 2.5s ease-out forwards;
        }
        .streak-text {
            font-size: 42px; font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 4px;
            color: #ffd700;
            text-shadow: 0 0 20px #ffd700, 0 0 40px rgba(255,215,0,0.5);
        }
        @keyframes streakAnim {
            0% { opacity: 0; transform: translate(-50%, -50%) scale(0.7); }
            10% { opacity: 1; transform: translate(-50%, -50%) scale(1.15); }
            20% { transform: translate(-50%, -50%) scale(1); }
            70% { opacity: 1; }
            100% { opacity: 0; transform: translate(-50%, -50%) scale(0.95) translateY(-15px); }
        }

        /* ═══ Game State Overlay ═══ */
        .game-overlay {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
            z-index: 500;
            text-align: center;
            opacity: 0;
            transition: opacity 0.5s;
        }
        .game-overlay.active { opacity: 1; }

        .overlay-title {
            font-size: 56px; font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 6px;
            margin-bottom: 12px;
            text-shadow: 0 0 20px currentColor, 0 0 40px currentColor;
        }
        .overlay-subtitle {
            font-size: 18px; font-weight: 700;
            letter-spacing: 3px;
            color: rgba(62,252,255,0.8);
            text-shadow: 0 0 10px #3efcff;
        }

        /* ═══ Damage Flash ═══ */
        .damage-flash {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none;
            z-index: 998;
            opacity: 0;
        }
        .damage-flash.active {
            animation: dmgFlash 0.4s ease-out forwards;
        }
        .damage-flash.critical {
            animation: dmgCrit 0.5s ease-out forwards;
        }
        @keyframes dmgFlash {
            0% { opacity: 1; background: radial-gradient(ellipse at center, transparent 40%, rgba(255,50,50,0.35) 100%); }
            100% { opacity: 0; }
        }
        @keyframes dmgCrit {
            0% { opacity: 1; background: radial-gradient(ellipse at center, transparent 20%, rgba(255,0,0,0.55) 100%); }
            100% { opacity: 0; }
        }

        /* ═══ Responsive ═══ */
        @media (max-width: 768px) {
            .vitals { width: 200px; }
            .weapon-panel { width: 180px; }
            .score-panel { width: 170px; }
            .hud-toggle { width: 36px; height: 36px; }
            .overlay-title { font-size: 36px; }
            .timer-display { font-size: 28px; }
            .score-value { font-size: 24px; }
            .ammo-display { font-size: 22px; }
        }
    </style>
</head>
<body>
    <div class="hud-container">
        <!-- HUD Toggle Button (always visible, has pointer-events) -->
        <div class="hud-toggle" id="hudToggle" onclick="toggleHud()">
            <svg class="eye-open" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/>
            </svg>
            <svg class="eye-closed" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                <path d="M12 7c2.76 0 5 2.24 5 5 0 .65-.13 1.26-.36 1.83l2.92 2.92c1.51-1.26 2.7-2.89 3.43-4.75-1.73-4.39-6-7.5-11-7.5-1.4 0-2.74.25-3.98.7l2.16 2.16C10.74 7.13 11.35 7 12 7zM2 4.27l2.28 2.28.46.46A11.8 11.8 0 001 12c1.73 4.39 6 7.5 11 7.5 1.55 0 3.03-.3 4.38-.84l.42.42L19.73 22 21 20.73 3.27 3 2 4.27zM7.53 9.8l1.55 1.55c-.05.21-.08.43-.08.65 0 1.66 1.34 3 3 3 .22 0 .44-.03.65-.08l1.55 1.55c-.67.33-1.41.53-2.2.53-2.76 0-5-2.24-5-5 0-.79.2-1.53.53-2.2zm4.31-.78l3.15 3.15.02-.16c0-1.66-1.34-3-3-3l-.17.01z"/>
            </svg>
        </div>

        <!-- All toggleable HUD elements -->
        <div class="hud-elements" id="hudElements">
            <!-- Damage Flash -->
            <div class="damage-flash" id="damageFlash"></div>

            <!-- Bottom-Left: VITALS -->
            <div class="vitals panel">
                <div class="health-container">
                    <div class="label">HP</div>
                    <div class="bar-wrapper">
                        <div class="bar health-bar" id="healthBar" style="width:100%"></div>
                        <div class="bar-text" id="healthText">100</div>
                    </div>
                </div>
                <div class="armor-container">
                    <div class="label">ARMOR</div>
                    <div class="bar-wrapper">
                        <div class="bar armor-bar" id="armorBar" style="width:0%"></div>
                        <div class="bar-text" id="armorText">0</div>
                    </div>
                </div>
            </div>

            <!-- Boost -->
            <div class="boost-indicator" id="boostIndicator">SPEED BOOST</div>

            <!-- Bottom-Right: WEAPON -->
            <div class="weapon-panel panel">
                <div class="weapon-icon" id="weaponIcon">
                    <svg class="weapon-svg" viewBox="0 0 120 60" xmlns="http://www.w3.org/2000/svg">
                        <rect x="35" y="25" width="50" height="10" rx="2"/>
                        <circle cx="32" cy="30" r="8"/>
                    </svg>
                </div>
                <div class="weapon-name" id="weaponName">UNARMED</div>
                <div class="ammo-display" id="ammoDisplay">-- / --</div>
            </div>

            <!-- Top-Left: SCORE -->
            <div class="score-panel panel">
                <div class="score-row">
                    <div class="score-item">
                        <div class="score-label">KILLS</div>
                        <div class="score-value" id="killsValue">0</div>
                    </div>
                    <div class="score-item">
                        <div class="score-label">DEATHS</div>
                        <div class="score-value" id="deathsValue">0</div>
                    </div>
                </div>
                <div class="kd-ratio" id="kdRatio">K/D: 0.00</div>
                <div class="streak-badge" id="streakBadge"></div>
            </div>

            <!-- Top-Center: TIMER (hidden by default) -->
            <div class="timer-panel panel" id="timerPanel">
                <div class="timer-display" id="timerDisplay">5:00</div>
            </div>

            <!-- Crosshair -->
            <div class="crosshair" id="crosshair">
                <div class="xh-line xh-top"></div>
                <div class="xh-line xh-bot"></div>
                <div class="xh-line xh-lft"></div>
                <div class="xh-line xh-rgt"></div>
                <div class="xh-dot"></div>
            </div>

            <!-- Kill Feed -->
            <div class="kill-feed" id="killFeed"></div>

            <!-- Pickup Flash -->
            <div class="pickup-flash" id="pickupFlash"></div>

            <!-- Streak Announce -->
            <div class="streak-announce" id="streakAnnounce">
                <div class="streak-text" id="streakText"></div>
            </div>

            <!-- Game Overlay -->
            <div class="game-overlay" id="gameOverlay">
                <div class="overlay-title" id="overlayTitle"></div>
                <div class="overlay-subtitle" id="overlaySubtitle"></div>
            </div>
        </div>
    </div>

    <script>
        // ══ STATE ══
        const S = {
            hp: 100, armor: 0,
            kills: 0, deaths: 0, streak: 0,
            weapon: 'none',
            clip: 0, reserve: 0,
            timerActive: false, timerSec: 0
        };

        // ══ DOM ══
        const $ = id => document.getElementById(id);
        const healthBar = $('healthBar'), healthText = $('healthText');
        const armorBar = $('armorBar'), armorText = $('armorText');
        const killsVal = $('killsValue'), deathsVal = $('deathsValue');
        const kdRatio = $('kdRatio'), streakBadge = $('streakBadge');
        const weaponIcon = $('weaponIcon'), weaponName = $('weaponName');
        const ammoDisp = $('ammoDisplay');
        const timerPanel = $('timerPanel'), timerDisp = $('timerDisplay');
        const crosshair = $('crosshair');
        const killFeed = $('killFeed');
        const pickupFlash = $('pickupFlash');
        const streakAnnounce = $('streakAnnounce'), streakText = $('streakText');
        const gameOverlay = $('gameOverlay'), overlayTitle = $('overlayTitle'), overlaySub = $('overlaySubtitle');
        const dmgFlash = $('damageFlash');
        const boostInd = $('boostIndicator');

        // ══ WEAPON SVGs ══
        const WEAPON_SVG = {
            none: '<svg class="weapon-svg" viewBox="0 0 120 60"><rect x="35" y="25" width="50" height="10" rx="2"/><circle cx="32" cy="30" r="8"/></svg>',
            pistol: '<svg class="weapon-svg" viewBox="0 0 120 60"><rect x="40" y="22" width="35" height="16" rx="2"/><rect x="30" y="28" width="15" height="4"/><rect x="75" y="26" width="8" height="8" rx="1"/><circle cx="38" cy="30" r="4"/></svg>',
            rifle: '<svg class="weapon-svg" viewBox="0 0 120 60"><rect x="25" y="26" width="70" height="8" rx="2"/><rect x="35" y="20" width="15" height="20" rx="2"/><rect x="15" y="28" width="12" height="4"/><circle cx="93" cy="30" r="5"/></svg>',
            shotgun: '<svg class="weapon-svg" viewBox="0 0 120 60"><rect x="25" y="24" width="65" height="12" rx="2"/><rect x="35" y="18" width="18" height="24" rx="2"/><rect x="15" y="28" width="12" height="4"/><rect x="88" y="27" width="10" height="6" rx="1"/></svg>'
        };

        // ══ STREAKS ══
        const STREAKS = [[15,'GODLIKE'],[10,'UNSTOPPABLE'],[7,'RAMPAGE'],[5,'KILLING SPREE'],[3,'TRIPLE KILL']];

        // ══ HEALTH ══
        function updateHealth(val) {
            const oldHp = S.hp;
            S.hp = Math.max(0, Math.min(100, val));
            healthBar.style.width = S.hp + '%';
            healthText.textContent = Math.round(S.hp);

            if (S.hp < oldHp) {
                const diff = oldHp - S.hp;
                dmgFlash.className = 'damage-flash';
                void dmgFlash.offsetWidth;
                dmgFlash.classList.add(diff >= 50 ? 'critical' : 'active');
                setTimeout(() => { dmgFlash.className = 'damage-flash'; }, 500);
            }

            healthBar.classList.toggle('pulse-red', S.hp > 0 && S.hp < 25);
        }

        // ══ ARMOR ══
        function updateArmor(val) {
            S.armor = Math.max(0, Math.min(200, val));
            armorBar.style.width = (S.armor / 200 * 100) + '%';
            armorText.textContent = Math.round(S.armor);
            armorBar.classList.toggle('pulse-blue', S.armor > 0 && S.armor < 50);
        }

        // ══ WEAPON ══
        function updateWeapon(type) {
            S.weapon = type.toLowerCase();
            weaponName.textContent = S.weapon === 'none' ? 'UNARMED' : S.weapon.toUpperCase();
            weaponIcon.innerHTML = WEAPON_SVG[S.weapon] || WEAPON_SVG.none;
            if (S.weapon === 'none') {
                ammoDisp.textContent = '-- / --';
                ammoDisp.className = 'ammo-display';
            }
        }

        // ══ AMMO ══
        function updateAmmo(clip, reserve) {
            S.clip = Math.max(0, clip);
            S.reserve = Math.max(0, reserve);
            if (S.weapon === 'none') return;
            ammoDisp.textContent = S.clip + ' / ' + S.reserve;
            ammoDisp.className = 'ammo-display';
            if (S.clip === 0) ammoDisp.classList.add('ammo-empty');
            else if (S.clip <= 3) ammoDisp.classList.add('ammo-low');
        }

        // ══ SCORE ══
        function updateScore() {
            killsVal.textContent = S.kills;
            deathsVal.textContent = S.deaths;
            const kd = S.deaths === 0 ? S.kills : (S.kills / S.deaths);
            kdRatio.textContent = 'K/D: ' + kd.toFixed(2);
        }

        // ══ STREAK ══
        function updateStreak() {
            let label = '';
            for (const [t, n] of STREAKS) { if (S.streak >= t) { label = n; break; } }
            if (label) {
                streakBadge.textContent = label;
                streakBadge.classList.add('active');
            } else {
                streakBadge.classList.remove('active');
            }
        }

        function checkStreakMilestone() {
            for (const [t, n] of STREAKS) {
                if (S.streak === t) {
                    streakText.textContent = n;
                    streakAnnounce.classList.remove('active');
                    void streakAnnounce.offsetWidth;
                    streakAnnounce.classList.add('active');
                    setTimeout(() => streakAnnounce.classList.remove('active'), 2500);
                    break;
                }
            }
        }

        // ══ TIMER ══
        function updateTimer(sec) {
            S.timerSec = Math.max(0, sec);
            if (!S.timerActive) { S.timerActive = true; timerPanel.classList.add('active'); }
            const m = Math.floor(S.timerSec / 60);
            const s = S.timerSec % 60;
            timerDisp.textContent = m + ':' + String(s).padStart(2, '0');
            timerDisp.classList.toggle('timer-warning', S.timerSec < 30 && S.timerSec > 0);
        }

        // Auto-countdown
        setInterval(() => {
            if (S.timerActive && S.timerSec > 0) updateTimer(S.timerSec - 1);
        }, 1000);

        // ══ KILL FEED ══
        function addKillFeed() {
            const msg = document.createElement('div');
            msg.className = 'kf-msg';
            msg.textContent = 'KILL CONFIRMED';
            killFeed.appendChild(msg);
            setTimeout(() => { if (msg.parentNode) msg.remove(); }, 2500);
            while (killFeed.children.length > 3) killFeed.removeChild(killFeed.firstChild);
        }

        // ══ HIT MARKER ══
        function flashHit() {
            crosshair.classList.add('hit');
            setTimeout(() => crosshair.classList.remove('hit'), 180);
        }

        // ══ PICKUP FLASH ══
        function showPickup(text, color) {
            pickupFlash.textContent = text;
            pickupFlash.style.color = color || '#3efcff';
            pickupFlash.style.textShadow = '0 0 15px ' + (color || '#3efcff');
            pickupFlash.classList.remove('active');
            void pickupFlash.offsetWidth;
            pickupFlash.classList.add('active');
            setTimeout(() => pickupFlash.classList.remove('active'), 2000);
        }

        // ══ GAME OVERLAY ══
        function showOverlay(title, sub, color, dur) {
            overlayTitle.textContent = title;
            overlayTitle.style.color = color || '#3efcff';
            overlaySub.textContent = sub || '';
            gameOverlay.classList.add('active');
            setTimeout(() => gameOverlay.classList.remove('active'), dur || 3000);
        }

        // ══ BOOST ══
        function setBoost(on) {
            if (on) boostInd.classList.add('active');
            else boostInd.classList.remove('active');
        }

        // ══ MESSAGE HANDLER ══
        function handleMsg(msg) {
            if (typeof msg !== 'string') return;

            // Multi-part messages (ammo, pickup)
            if (msg.startsWith('ammo_')) {
                const p = msg.split('_');
                if (p.length === 3) updateAmmo(parseInt(p[1]) || 0, parseInt(p[2]) || 0);
                return;
            }
            if (msg.startsWith('weapon_')) { updateWeapon(msg.substring(7)); return; }
            if (msg.startsWith('pickup_')) {
                const rest = msg.substring(7);
                const idx = rest.lastIndexOf('_');
                if (idx > 0) showPickup(rest.substring(0, idx).replace(/_/g, ' '), rest.substring(idx + 1));
                else showPickup(rest.replace(/_/g, ' '), '#3efcff');
                return;
            }
            if (msg === 'hit_1') { flashHit(); return; }
            if (msg === 'toggle_1') { toggleHud(); return; }

            // Standard key_value
            const sep = msg.indexOf('_');
            if (sep === -1) return;
            const key = msg.substring(0, sep);
            const val = parseFloat(msg.substring(sep + 1));

            switch (key) {
                case 'health': updateHealth(val); break;
                case 'armor': updateArmor(val); break;
                case 'kill':
                    S.kills = val; S.streak++;
                    updateScore(); updateStreak(); checkStreakMilestone();
                    if (val > 0) addKillFeed();
                    break;
                case 'death':
                    S.deaths = val; S.streak = 0;
                    updateScore(); updateStreak();
                    break;
                case 'timer': updateTimer(val); break;
                case 'boost': setBoost(val); break;
                case 'start':
                    if (val === 1) showOverlay('MATCH START', 'FIGHT FOR SURVIVAL', '#3efcff', 2500);
                    break;
                case 'gameover':
                    if (val === 1) {
                        const kd = S.deaths === 0 ? S.kills : (S.kills / S.deaths).toFixed(2);
                        showOverlay('MATCH OVER', S.kills + ' KILLS  /  K/D: ' + kd, '#ffd700', 5000);
                    }
                    break;
                case 'dead':
                    if (val === 1) showOverlay('ELIMINATED', 'RESPAWNING...', '#ff3333', 2000);
                    break;
                case 'respawn':
                    if (val === 1) { updateHealth(100); S.streak = 0; updateStreak(); }
                    break;
            }
        }

        // ══ PORTALS SDK ══
        if (typeof PortalsSdk !== 'undefined') {
            PortalsSdk.setMessageListener(function(message) { handleMsg(message); });
        }

        // Fallback for browser testing
        window.addEventListener('message', function(e) {
            const d = e.data;
            if (typeof d === 'string') handleMsg(d);
            else if (d && d.type === 'portals') handleMsg(d.data);
        });

        // ══ HUD TOGGLE (J key — or toggle_1 message from Portals) ══
        let hudVisible = true;
        function toggleHud() {
            hudVisible = !hudVisible;
            const el = $('hudElements');
            const btn = $('hudToggle');
            el.classList.toggle('hud-hidden', !hudVisible);
            btn.classList.toggle('hidden', !hudVisible);
        }
        window.addEventListener('keydown', function(e) {
            if (e.key === 'j' || e.key === 'J') toggleHud();
        });

        // ══ INIT ══
        updateHealth(100);
        updateArmor(0);
        updateScore();
        updateWeapon('none');
    </script>
</body>
</html>
